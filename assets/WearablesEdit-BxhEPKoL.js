import{c as C,r as s,j as e,m as F,B as N,C as M,F as U,a as $,G as W,T as V,H as q,f as o,I as G,J,K,g as O,M as Q}from"./index-CiCFYCZO.js";import{E as S}from"./ElementTitleHeader-gt-0V5GJ.js";import{u as X}from"./useWearable-40aP__BY.js";import{I as Y,B as Z,F as y}from"./Backdrop-DxRIVAzR.js";import{$ as L}from"./module-0Qkd8c0D.js";import{A as ee,a as te,b as re,S as ae,c as se}from"./SharedDeviceUsersList-DNntcBxL.js";import{F as T}from"./FieldContainerInput-C8DthUKJ.js";import{H as w}from"./HorizontalDivider-C9_eaf2y.js";import{W as ie}from"./WearableRefreshRate-B2JCYlzV.js";import{g as ne,u as oe}from"./storage-Ccmrfn-5.js";import"./react-C7sMpjI8.js";import"./react-dom-ThsgQk-A.js";import"./alert-dialog-Blbhtqyw.js";import"./eye-CD-J9R5m.js";import"./pencil-BVNrYIRr.js";import"./clock-BSZWe9JE.js";import"./share-2-BjCGG_H2.js";import"./input-sNI5g_f2.js";import"./index-yVTYpdoT.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=C("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=C("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),I=s.forwardRef(({className:d,...u},m)=>e.jsx("textarea",{className:F("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",d),ref:m,...u}));I.displayName="Textarea";const ce=({value:d,onConfirm:u,onChange:m,placeholder:v,...i})=>{const{isEditing:f,setIsEditing:h}=s.useContext(Y),n=s.useRef(null),[t,p]=s.useState(d??"");s.useEffect(()=>{p(d??""),n.current&&g()},[d]),s.useEffect(()=>{if(n.current){const l=parseFloat(getComputedStyle(n.current).lineHeight||"20");n.current.style.height=`${l*2}px`}},[]);const g=()=>{n.current&&(n.current.style.height="auto",n.current.style.height=`${n.current.scrollHeight}px`)},x=()=>{u?u(t).finally(()=>{h(!1)}):h(!1)},j=l=>{p(l.target.value),m&&m(l),g()};return e.jsxs(e.Fragment,{children:[f&&e.jsx(Z,{onClose:x,open:f,confirm:d!==t}),e.jsx("div",{className:F("text-md flex items-center relative w-full",f?"rounded-md gap-2 z-[20] sm:max-w-md":"gap-4 max-w-xs"),onSubmit:l=>{l.preventDefault(),x()},children:e.jsxs("div",{className:"relative flex w-full",children:[e.jsx(I,{ref:n,value:t,onChange:j,placeholder:v,onFocusCapture:()=>h(!0),onBlur:()=>{h(!1),x()},className:F("w-full resize-none overflow-hidden min-h-3",f?"pr-10":""),...i}),f&&e.jsx(N,{onClick:x,type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 px-3 py-2 hover:bg-transparent",children:e.jsx(M,{className:"h-4 w-4 horizontal-grow z-10",color:"white"})})]})})]})},Ce=()=>{var E;const{id:d}=U(),u=s.useRef(null),[m,v]=s.useState(!1),{wearable:i,loading:f}=X(d),[h,n]=s.useState(null),[t,p]=s.useState(void 0),[g,x]=s.useState(void 0),[j,l]=s.useState(void 0),[k,D]=s.useState(),A=$();if(s.useEffect(()=>{i&&(p(i),x(i.birthday?new Date(i.birthday).toLocaleDateString("pt-BR"):void 0),i.avatar_url&&n(ne(i.avatar_url).data.publicUrl),i.refresh_delay&&l(i.refresh_delay))},[i]),f)return e.jsx("div",{children:"Carregando..."});if(!i)return e.jsx("div",{className:"text-white",children:"Pulseira não encontrado"});const R=async a=>{p(r=>r&&{...r,name:a})},z=()=>{var a;(a=u.current)==null||a.click()},_=a=>{var c;const r=(c=a.target.files)==null?void 0:c[0];if(D(r),r){const b=new FileReader;b.onload=()=>{const P=b.result;n(P)},b.onerror=()=>{o.error("Erro ao carregar foto de perfil.")},b.readAsDataURL(r)}},B=()=>{n(null),D(void 0),o.info("Foto de perfil removida.")},H=async()=>{if(!t)return;if(!g){o.error("Data de nascimento inválida.");return}if(!t.name){o.error("Nome inválido.");return}if(!t.id){o.error("ID inválido.");return}if(!j){o.error("Taxa de atualização inválida.");return}v(!0);let a=null;try{if(k){const{data:r,error:c}=await oe(t.id,k);if(c)throw c;r&&(a=r.path)}try{const r={name:t.name,birthday:new Date(g).toISOString(),other_info:t.other_info,refresh_delay:j};a&&(r.avatar_url=a);const{error:c}=await Q(t.id,r);if(c)throw c;o.success("Dados salvos com sucesso."),A(`/wearables/view/${t.id}`)}catch(r){console.error(r),o.error("Erro ao salvar dados.")}}catch(r){console.error(r),o.error("Erro ao salvar foto de perfil.")}v(!1)};return e.jsxs("div",{className:"space-y-3 text-white",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(S,{className:"text-white",title:t!=null&&t.name?t==null?void 0:t.name:"Sem nome"}),e.jsxs(ee,{className:"h-36 w-36 mt-6 mb-3 border-2 border-white shadow-md",children:[e.jsx(te,{src:h||void 0,className:"object-cover "}),e.jsx(re,{className:"text-white text-7xl font-semibold bg-white/10",children:(E=W(t!=null&&t.name?t==null?void 0:t.name:"Sem nome"))==null?void 0:E.slice(0,2)})]}),e.jsxs(V,{children:[e.jsx(q,{onClick:()=>{navigator.clipboard.writeText((t==null?void 0:t.id)??""),o.success("Endereço MAC copiado para a área de transferência")},children:e.jsx("div",{className:"flex items-center justify-center border rounded-md px-2 text-white ",children:t==null?void 0:t.id})}),e.jsxs(G,{side:"bottom",children:[e.jsx("p",{children:"Endereço MAC"}),e.jsx(J,{className:"stroke-white fill-white"})]})]})]}),e.jsx(w,{className:"my-7"}),e.jsx(y,{title:"Nome",children:e.jsx(T,{value:(t==null?void 0:t.name)??"Sem Nome",onChange:a=>R(a.target.value),type:"text",placeholder:"Fulano da Silva"})}),e.jsx(y,{title:"Data de Nascimento",children:e.jsx(T,{value:g,placeholder:"Dia/Mês/Ano",onChange:a=>{const r=K(a.target.value);x(r)},type:"text",inputMode:"numeric",pattern:"\\d*",maxLength:10})}),e.jsxs(y,{title:"Foto de Perfil",children:[e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:_,ref:u}),h?e.jsxs(N,{variant:"secondary",size:"sm",onClick:B,children:["Remover Foto",e.jsx(le,{})]}):e.jsxs(N,{variant:"secondary",size:"sm",onClick:z,children:["Enviar Foto",e.jsx(de,{})]})]}),e.jsx(y,{title:"Informações Adicionais",children:e.jsx(ce,{placeholder:"Informações sobre dificuldades físicas.",value:(t==null?void 0:t.other_info)??"",onChange:a=>{p(r=>r&&{...r,other_info:a.target.value})}})}),e.jsx(w,{className:"mt-8"}),e.jsx(S,{title:"Configuração da pulseira",description:"Defina as configurações da pulseira."}),e.jsx(O,{title:"Taxa de atualização",titleBackground:!0,border:!0,children:e.jsx("div",{className:"px-6 py-4 text-white",children:e.jsx(ie,{defaultValue:(t==null?void 0:t.refresh_delay)||void 0,onChangeComplete:a=>{l(a)}})})}),e.jsx(w,{className:"mt-8"}),e.jsx(S,{title:"Compartilhamento",description:"Aqui estão as pessoas com quem você compartilhou esta pulseira."}),e.jsx(ae,{id:i.id}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(N,{className:"bg-white text-primary",onClick:H,disabled:m,children:m?e.jsxs(e.Fragment,{children:["Atualizando ",e.jsx(L,{strokeColor:"#4b33be"})]}):e.jsxs(e.Fragment,{children:["Salvar ",e.jsx(se,{})]})})})]})};export{Ce as default};
