import{c as N,r as n,j as e,p as oe,k as E,G as le,H as _,l as v,B as w,C as z,I as T,J as de,K as ce,M as ue,O as k,Q as M,e as p,S as me,F as fe,a as he,T as xe,U as pe,V as ge,W as ve,X as je,Y as we,f as ye,Z as be}from"./index-D7Yp8jQw.js";import{E as C}from"./ElementTitleHeader-DUOmk4_y.js";import{u as Ne}from"./useWearable-CAJQao7Y.js";import{I as U,B,F as A,W as Se}from"./Backdrop-DgZgu4Jd.js";import{$ as V}from"./module-BCK5vQsl.js";import{I as ke}from"./input-C18XhAi5.js";import{H as b}from"./HorizontalDivider-CHEKQ5P9.js";import{g as Ae,u as Ce}from"./storage-BuM2OKLt.js";import{E as Ee}from"./eye-DClkKJtw.js";import{P as Fe}from"./pencil-CrJatnSm.js";import{S as Ie}from"./share-2-CcOCMcrx.js";import"./react-DDCWQfk_.js";import"./react-dom-DZBigVa_.js";import"./index-DkU7GfEn.js";import"./alert-dialog--uEgFtxK.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=N("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=N("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=N("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=N("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=N("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var F="Avatar",[ze,is]=oe(F),[Te,H]=ze(F),W=n.forwardRef((r,t)=>{const{__scopeAvatar:i,...u}=r,[o,d]=n.useState("idle");return e.jsx(Te,{scope:i,imageLoadingStatus:o,onImageLoadingStatusChange:d,children:e.jsx(E.span,{...u,ref:t})})});W.displayName=F;var $="AvatarImage",q=n.forwardRef((r,t)=>{const{__scopeAvatar:i,src:u,onLoadingStatusChange:o=()=>{},...d}=r,c=H($,i),a=Ue(u,d.referrerPolicy),s=le(l=>{o(l),c.onImageLoadingStatusChange(l)});return _(()=>{a!=="idle"&&s(a)},[a,s]),a==="loaded"?e.jsx(E.img,{...d,ref:t,src:u}):null});q.displayName=$;var L="AvatarFallback",K=n.forwardRef((r,t)=>{const{__scopeAvatar:i,delayMs:u,...o}=r,d=H(L,i),[c,a]=n.useState(u===void 0);return n.useEffect(()=>{if(u!==void 0){const s=window.setTimeout(()=>a(!0),u);return()=>window.clearTimeout(s)}},[u]),c&&d.imageLoadingStatus!=="loaded"?e.jsx(E.span,{...o,ref:t}):null});K.displayName=L;function Ue(r,t){const[i,u]=n.useState("idle");return _(()=>{if(!r){u("error");return}let o=!0;const d=new window.Image,c=a=>()=>{o&&u(a)};return u("loading"),d.onload=c("loaded"),d.onerror=c("error"),d.src=r,t&&(d.referrerPolicy=t),()=>{o=!1}},[r,t]),i}var O=W,G=q,J=K;const Q=n.forwardRef(({className:r,...t},i)=>e.jsx(O,{ref:i,className:v("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...t}));Q.displayName=O.displayName;const X=n.forwardRef(({className:r,...t},i)=>e.jsx(G,{ref:i,className:v("aspect-square h-full w-full",r),...t}));X.displayName=G.displayName;const Y=n.forwardRef(({className:r,...t},i)=>e.jsx(J,{ref:i,className:v("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...t}));Y.displayName=J.displayName;const P=({value:r,onConfirm:t,onChange:i,placeholder:u,closedSize:o,...d})=>{const{isEditing:c,setIsEditing:a}=n.useContext(U),[s,l]=n.useState(r??"");n.useEffect(()=>{l(r??"")},[r]);const h=()=>{t?t(s).finally(()=>{a(!1)}):a(!1)},g=x=>{l(x.target.value),i&&i(x)},y=()=>{switch(o){case"xs":return"";case"sm":return"w-56";case"md":return"w-72";case"lg":return"w-96";default:return""}};return e.jsxs(e.Fragment,{children:[c&&e.jsx(B,{onClose:h,open:c,confirm:r!==s}),e.jsx("div",{className:v("text-lg flex items-center relative",y(),c?"rounded-md gap-2 z-[20] w-full sm:max-w-xs":"gap-4"),onSubmit:x=>{x.preventDefault(),h()},children:e.jsxs("div",{className:"relative flex w-full",children:[e.jsx(ke,{value:r,onChange:g,placeholder:u,onFocus:()=>{a(!0)},onBlur:()=>{a(!1),h()},className:v("w-full",c?"pr-10":""),...d}),c&&e.jsx(e.Fragment,{children:e.jsx(w,{onClick:h,type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",children:e.jsx(z,{className:"h-4 w-4 horizontal-grow z-10",color:"white"})})})]})})]})},Z=n.forwardRef(({className:r,...t},i)=>e.jsx("textarea",{className:v("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:i,...t}));Z.displayName="Textarea";const Be=({value:r,onConfirm:t,onChange:i,placeholder:u,...o})=>{const{isEditing:d,setIsEditing:c}=n.useContext(U),a=n.useRef(null),[s,l]=n.useState(r??"");n.useEffect(()=>{l(r??""),a.current&&h()},[r]),n.useEffect(()=>{if(a.current){const x=parseFloat(getComputedStyle(a.current).lineHeight||"20");a.current.style.height=`${x*2}px`}},[]);const h=()=>{a.current&&(a.current.style.height="auto",a.current.style.height=`${a.current.scrollHeight}px`)},g=()=>{t?t(s).finally(()=>{c(!1)}):c(!1)},y=x=>{l(x.target.value),i&&i(x),h()};return e.jsxs(e.Fragment,{children:[d&&e.jsx(B,{onClose:g,open:d,confirm:r!==s}),e.jsx("div",{className:v("text-md flex items-center relative w-full",d?"rounded-md gap-2 z-[20] sm:max-w-md":"gap-4 max-w-xs"),onSubmit:x=>{x.preventDefault(),g()},children:e.jsxs("div",{className:"relative flex w-full",children:[e.jsx(Z,{ref:a,value:s,onChange:y,placeholder:u,onFocusCapture:()=>c(!0),onBlur:()=>{c(!1),g()},className:v("w-full resize-none overflow-hidden min-h-3",d?"pr-10":""),...o}),d&&e.jsx(w,{onClick:g,type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 px-3 py-2 hover:bg-transparent",children:e.jsx(z,{className:"h-4 w-4 horizontal-grow z-10",color:"white"})})]})})]})};async function Ve(r){console.log("id",r);const t=await T.from("permissions_view").select().eq("device",r).order("created_at",{ascending:!1});return console.log("res",t),t}async function He(r,t){return await T.from("tracking_permissions").update({permission:t}).eq("id",r).select().returns()}function We(r){const[t,i]=n.useState([]),[u,o]=n.useState(!0),[d,c]=n.useState(0),a=n.useCallback(()=>{c(s=>s+1),console.log("forceUpdate")},[]);return n.useEffect(()=>{if(!r)return;(async()=>{o(!0);try{const l=await Ve(r);l.error?(console.error("Error fetching permissions:",l.error),i([])):i(l.data)}catch(l){console.error("Unexpected error fetching permissions:",l),i([])}finally{o(!1)}})()},[r,d]),{permissions:t,loading:u,forceUpdate:a}}const $e=({permission:r,users:t,forceUpdate:i,loading:u})=>{const o=t.find(a=>a.id===r.user),d=async a=>{if(r.id)try{const s=await He(r.id,a);if(s.error)throw new Error(s.error.message);p.success("Permissão atualizada com sucesso"),i()}catch(s){console.error("Unexpected error updating permission:",s),p.error("Algo deu errado ao atualizar a permissão")}},c=()=>{switch(r.permission){case"viewer":return"Apenas ver";case"editor":return"Ver e editar";case"pending":return"Aguardando";case"blocked":return"Bloqueado"}};return e.jsxs("div",{className:"text-white flex justify-between items-center p-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold line-clamp-1",children:o==null?void 0:o.name}),u?e.jsx("div",{className:"flex space-x-2",children:e.jsxs("div",{className:"bg-background border flex text-sm gap-1 rounded-full px-2 py-1 font-medium items-center text-muted",children:["Atualizando",e.jsx(V,{strokeColor:"white",width:"15"})]})}):e.jsxs("div",{className:"flex space-x-2",children:[(r.permission==="viewer"||r.permission==="editor")&&e.jsxs("div",{className:"bg-[#7AC74F] flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Visualizar",e.jsx(Ee,{className:"h-4"})]}),r.permission==="editor"&&e.jsxs("div",{className:"bg-[#FAA916] flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Modificar",e.jsx(Fe,{className:"h-3"})]}),r.permission==="pending"&&e.jsxs("div",{className:"bg-background border flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Pendente",e.jsx(Re,{className:"h-3"})]})]})]}),e.jsx("div",{children:e.jsxs(de,{children:[e.jsx(ce,{children:e.jsxs(w,{variant:r.permission==="pending"?"default":"secondary",className:v(r.permission==="pending"?"text-primary bg-white":""),size:"sm",children:[c()," ",e.jsx(De,{})]})}),e.jsxs(ue,{side:"bottom",children:[e.jsx(k,{onClick:()=>{d("editor")},children:"Ver e editar"}),e.jsx(k,{onClick:()=>{d("viewer")},children:"Apenas ver"}),e.jsx(M,{}),e.jsx(k,{onClick:()=>{d("pending")},children:"Remover permissão"}),e.jsx(M,{}),e.jsx(k,{onClick:()=>{d("blocked")},children:"Bloquear"})]})]})})]})},qe=({id:r})=>{const{permissions:t,loading:i,forceUpdate:u}=We(r),[o,d]=n.useState([]),c=n.useMemo(()=>t.filter(l=>l.permission!=="blocked"),[t]),a=n.useMemo(()=>{const l=[];for(const h of c)h.user&&l.push(h.user);return l},[c]),s=async()=>{try{const l=await me(a);if(l.error)throw new Error(l.error.message);console.log("Users fetched:",l),d(l.data)}catch(l){console.log("Unexpected error fetching users:",l),p.error("Algo deu errado ao buscar os usuários")}};return n.useEffect(()=>{a.length&&s()},[a]),e.jsx("div",{children:e.jsxs("ul",{children:[c.map(l=>e.jsxs("li",{children:[e.jsx(b,{className:"border-white my-0"}),e.jsx($e,{permission:l,users:o,forceUpdate:u,loading:i})]},l.user)),e.jsxs("li",{children:[e.jsx(b,{className:"border-white my-0"}),e.jsx("div",{className:"flex justify-center p-4 ",children:e.jsx(w,{variant:"secondary",disabled:i,children:i?"Carregando...":e.jsxs(e.Fragment,{children:["Compartilhar com outro usuário ",e.jsx(Ie,{})]})})})]})]})})},os=()=>{var R;const{id:r}=fe(),t=n.useRef(null),[i,u]=n.useState(!1),{wearable:o,loading:d}=Ne(r),[c,a]=n.useState(null),[s,l]=n.useState(void 0),[h,g]=n.useState(void 0),[y,x]=n.useState(void 0),[I,D]=n.useState(),ee=he();if(n.useEffect(()=>{o&&(l(o),g(o.birthday?new Date(o.birthday).toLocaleDateString("pt-BR"):void 0),o.avatar_url&&a(Ae(o.avatar_url).data.publicUrl),o.refresh_delay&&x(o.refresh_delay))},[o]),d)return e.jsx("div",{children:"Carregando..."});if(!o)return e.jsx("div",{className:"text-white",children:"Pulseira não encontrado"});const se=async f=>{l(m=>m&&{...m,name:f})},re=()=>{var f;(f=t.current)==null||f.click()},te=f=>{var j;const m=(j=f.target.files)==null?void 0:j[0];if(D(m),m){const S=new FileReader;S.onload=()=>{const ie=S.result;a(ie)},S.onerror=()=>{p.error("Erro ao carregar foto de perfil.")},S.readAsDataURL(m)}},ae=()=>{a(null),D(void 0),p.info("Foto de perfil removida.")},ne=async()=>{if(!s)return;if(!h){p.error("Data de nascimento inválida.");return}if(!s.name){p.error("Nome inválido.");return}if(!s.id){p.error("ID inválido.");return}if(!y){p.error("Taxa de atualização inválida.");return}u(!0);let f=null;try{if(I){const{data:m,error:j}=await Ce(s.id,I);if(j)throw j;m&&(f=m.path)}try{const m={name:s.name,birthday:new Date(h).toISOString(),other_info:s.other_info,refresh_delay:y};f&&(m.avatar_url=f);const{error:j}=await be(s.id,m);if(j)throw j;p.success("Dados salvos com sucesso."),ee(`/wearables/view/${s.id}`)}catch(m){console.error(m),p.error("Erro ao salvar dados.")}}catch(m){console.error(m),p.error("Erro ao salvar foto de perfil.")}u(!1)};return e.jsxs("div",{className:"space-y-3 text-white",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(C,{className:"text-white",title:s!=null&&s.name?s==null?void 0:s.name:"Sem nome"}),e.jsxs(Q,{className:"h-36 w-36 mt-6 mb-3 border-2 border-white shadow-md",children:[e.jsx(X,{src:c||void 0,className:"object-cover "}),e.jsx(Y,{className:"text-white text-7xl font-semibold bg-white/10",children:(R=xe(s!=null&&s.name?s==null?void 0:s.name:"Sem nome"))==null?void 0:R.slice(0,2)})]}),e.jsxs(pe,{children:[e.jsx(ge,{onClick:()=>{navigator.clipboard.writeText((s==null?void 0:s.id)??""),p.success("Endereço MAC copiado para a área de transferência")},children:e.jsx("div",{className:"flex items-center justify-center border rounded-md px-2 text-white ",children:s==null?void 0:s.id})}),e.jsxs(ve,{side:"bottom",children:[e.jsx("p",{children:"Endereço MAC"}),e.jsx(je,{className:"stroke-white fill-white"})]})]})]}),e.jsx(b,{className:"my-7"}),e.jsx(A,{title:"Nome",children:e.jsx(P,{value:(s==null?void 0:s.name)??"Sem Nome",onChange:f=>se(f.target.value),type:"text",placeholder:"Fulano da Silva"})}),e.jsx(A,{title:"Data de Nascimento",children:e.jsx(P,{value:h,placeholder:"Dia/Mês/Ano",onChange:f=>{const m=we(f.target.value);g(m)},type:"text",inputMode:"numeric",pattern:"\\d*",maxLength:10})}),e.jsxs(A,{title:"Foto de Perfil",children:[e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:te,ref:t}),c?e.jsxs(w,{variant:"secondary",size:"sm",onClick:ae,children:["Remover Foto",e.jsx(Pe,{})]}):e.jsxs(w,{variant:"secondary",size:"sm",onClick:re,children:["Enviar Foto",e.jsx(_e,{})]})]}),e.jsx(A,{title:"Informações Adicionais",children:e.jsx(Be,{placeholder:"Informações sobre dificuldades físicas.",value:(s==null?void 0:s.other_info)??"",onChange:f=>{l(m=>m&&{...m,other_info:f.target.value})}})}),e.jsx(b,{className:"mt-8"}),e.jsx(C,{title:"Configuração da pulseira",description:"Defina as configurações da pulseira."}),e.jsx(ye,{title:"Taxa de atualização",titleBackground:!0,border:!0,children:e.jsx("div",{className:"px-6 py-4 text-white",children:e.jsx(Se,{defaultValue:(s==null?void 0:s.refresh_delay)||void 0,onChangeComplete:f=>{x(f)}})})}),e.jsx(b,{className:"mt-8"}),e.jsx(C,{title:"Compartilhamento",description:"Aqui estão as pessoas com quem você compartilhou esta pulseira."}),e.jsx(qe,{id:o.id}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(w,{className:"bg-white text-primary",onClick:ne,disabled:i,children:i?e.jsxs(e.Fragment,{children:["Atualizando ",e.jsx(V,{strokeColor:"#4b33be"})]}):e.jsxs(e.Fragment,{children:["Salvar ",e.jsx(Me,{})]})})})]})};export{os as default};
