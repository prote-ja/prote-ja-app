import{c as H,r as d,j as r,q as T,l as E,Y as W,J as b,m as g,a9 as M,ak as K,al as G,B as _,am as O,an as x,ao as k,f as A,ap as J}from"./index-Cr1tPlUk.js";import{r as Y}from"./react-C1_t6syo.js";import{$ as Q}from"./module-BOwYaUhB.js";import{E as X}from"./eye-DxzYEcXg.js";import{P as Z}from"./pencil-CoD132HQ.js";import{C as ee}from"./clock-CdoYu02g.js";import{C as re}from"./chevron-down-kXr6bpTU.js";import{H as C}from"./HorizontalDivider-B4I3U6a1.js";import{S as se}from"./share-2-DrhdAHqu.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=H("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var w={exports:{}},j={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L;function te(){if(L)return j;L=1;var e=Y();function s(l,m){return l===m&&(l!==0||1/l===1/m)||l!==l&&m!==m}var a=typeof Object.is=="function"?Object.is:s,u=e.useState,c=e.useEffect,t=e.useLayoutEffect,f=e.useDebugValue;function o(l,m){var v=m(),S=u({inst:{value:v,getSnapshot:m}}),p=S[0].inst,y=S[1];return t(function(){p.value=v,p.getSnapshot=m,i(p)&&y({inst:p})},[l,v,m]),c(function(){return i(p)&&y({inst:p}),l(function(){i(p)&&y({inst:p})})},[l]),f(v),v}function i(l){var m=l.getSnapshot;l=l.value;try{var v=m();return!a(l,v)}catch{return!0}}function n(l,m){return m()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?n:o;return j.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:h,j}var R;function ae(){return R||(R=1,w.exports=te()),w.exports}var ne=ae();function oe(){return ne.useSyncExternalStore(ie,()=>!0,()=>!1)}function ie(){return()=>{}}var N="Avatar",[ce,Ce]=T(N),[de,U]=ce(N),P=d.forwardRef((e,s)=>{const{__scopeAvatar:a,...u}=e,[c,t]=d.useState("idle");return r.jsx(de,{scope:a,imageLoadingStatus:c,onImageLoadingStatusChange:t,children:r.jsx(E.span,{...u,ref:s})})});P.displayName=N;var D="AvatarImage",q=d.forwardRef((e,s)=>{const{__scopeAvatar:a,src:u,onLoadingStatusChange:c=()=>{},...t}=e,f=U(D,a),o=ue(u,t),i=W(n=>{c(n),f.onImageLoadingStatusChange(n)});return b(()=>{o!=="idle"&&i(o)},[o,i]),o==="loaded"?r.jsx(E.img,{...t,ref:s,src:u}):null});q.displayName=D;var V="AvatarFallback",$=d.forwardRef((e,s)=>{const{__scopeAvatar:a,delayMs:u,...c}=e,t=U(V,a),[f,o]=d.useState(u===void 0);return d.useEffect(()=>{if(u!==void 0){const i=window.setTimeout(()=>o(!0),u);return()=>window.clearTimeout(i)}},[u]),f&&t.imageLoadingStatus!=="loaded"?r.jsx(E.span,{...c,ref:s}):null});$.displayName=V;function I(e,s){return e?s?(e.src!==s&&(e.src=s),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function ue(e,{referrerPolicy:s,crossOrigin:a}){const u=oe(),c=d.useRef(null),t=u?(c.current||(c.current=new window.Image),c.current):null,[f,o]=d.useState(()=>I(t,e));return b(()=>{o(I(t,e))},[t,e]),b(()=>{const i=l=>()=>{o(l)};if(!t)return;const n=i("loaded"),h=i("error");return t.addEventListener("load",n),t.addEventListener("error",h),s&&(t.referrerPolicy=s),typeof a=="string"&&(t.crossOrigin=a),()=>{t.removeEventListener("load",n),t.removeEventListener("error",h)}},[t,a,s]),f}var B=P,F=q,z=$;const le=d.forwardRef(({className:e,...s},a)=>r.jsx(B,{ref:a,className:g("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s}));le.displayName=B.displayName;const fe=d.forwardRef(({className:e,...s},a)=>r.jsx(F,{ref:a,className:g("aspect-square h-full w-full",e),...s}));fe.displayName=F.displayName;const me=d.forwardRef(({className:e,...s},a)=>r.jsx(z,{ref:a,className:g("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s}));me.displayName=z.displayName;async function pe(e){console.log("id",e);const s=await M.from("permissions_view").select().eq("device",e).order("created_at",{ascending:!1});return console.log("res",s),s}async function he(e,s){return await M.from("tracking_permissions").update({permission:s}).eq("id",e).select().returns()}function ve(e){const[s,a]=d.useState([]),[u,c]=d.useState(!0),[t,f]=d.useState(0),o=d.useCallback(()=>{f(i=>i+1),console.log("forceUpdate")},[]);return d.useEffect(()=>{if(!e)return;(async()=>{c(!0);try{const n=await pe(e);n.error?(console.error("Error fetching permissions:",n.error),a([])):a(n.data)}catch(n){console.error("Unexpected error fetching permissions:",n),a([])}finally{c(!1)}})()},[e,t]),{permissions:s,loading:u,forceUpdate:o}}const xe=({permission:e,users:s,forceUpdate:a,loading:u})=>{const c=s.find(o=>o.id===e.user),t=async o=>{if(e.id)try{const i=await he(e.id,o);if(i.error)throw new Error(i.error.message);A.success("Permissão atualizada com sucesso"),a()}catch(i){console.error("Unexpected error updating permission:",i),A.error("Algo deu errado ao atualizar a permissão")}},f=()=>{switch(e.permission){case"viewer":return"Apenas ver";case"editor":return"Ver e editar";case"pending":return"Aguardando";case"blocked":return"Bloqueado"}};return r.jsxs("div",{className:"text-white flex justify-between items-center p-2",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("h3",{className:"text-xl font-semibold line-clamp-1",children:c==null?void 0:c.name}),u?r.jsx("div",{className:"flex space-x-2",children:r.jsxs("div",{className:"bg-background border flex text-sm gap-1 rounded-full px-2 py-1 font-medium items-center text-muted",children:["Atualizando",r.jsx(Q,{strokeColor:"white",width:"15"})]})}):r.jsxs("div",{className:"flex space-x-2",children:[(e.permission==="viewer"||e.permission==="editor")&&r.jsxs("div",{className:"bg-[#7AC74F] flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Visualizar",r.jsx(X,{className:"h-4"})]}),e.permission==="editor"&&r.jsxs("div",{className:"bg-[#FAA916] flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Modificar",r.jsx(Z,{className:"h-3"})]}),e.permission==="pending"&&r.jsxs("div",{className:"bg-background border flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Pendente",r.jsx(ee,{className:"h-3"})]})]})]}),r.jsx("div",{children:r.jsxs(K,{children:[r.jsx(G,{children:r.jsxs(_,{variant:e.permission==="pending"?"default":"secondary",className:g(e.permission==="pending"?"text-primary bg-white":""),size:"sm",children:[f()," ",r.jsx(re,{})]})}),r.jsxs(O,{side:"bottom",children:[r.jsx(x,{onClick:()=>{t("editor")},children:"Ver e editar"}),r.jsx(x,{onClick:()=>{t("viewer")},children:"Apenas ver"}),r.jsx(k,{}),r.jsx(x,{onClick:()=>{t("pending")},children:"Remover permissão"}),r.jsx(k,{}),r.jsx(x,{onClick:()=>{t("blocked")},children:"Bloquear"})]})]})})]})},Le=({id:e})=>{const{permissions:s,loading:a,forceUpdate:u}=ve(e),[c,t]=d.useState([]),f=d.useMemo(()=>s.filter(n=>n.permission!=="blocked"),[s]),o=d.useMemo(()=>{const n=[];for(const h of f)h.user&&n.push(h.user);return n},[f]),i=async()=>{try{const n=await J(o);if(n.error)throw new Error(n.error.message);console.log("Users fetched:",n),t(n.data)}catch(n){console.log("Unexpected error fetching users:",n),A.error("Algo deu errado ao buscar os usuários")}};return d.useEffect(()=>{o.length&&i()},[o]),r.jsx("div",{children:r.jsxs("ul",{children:[f.map(n=>r.jsxs("li",{children:[r.jsx(C,{className:"border-white my-0"}),r.jsx(xe,{permission:n,users:c,forceUpdate:u,loading:a})]},n.user)),r.jsxs("li",{children:[r.jsx(C,{className:"border-white my-0"}),r.jsx("div",{className:"flex justify-center p-4 ",children:r.jsx(_,{variant:"secondary",disabled:a,children:a?"Carregando...":r.jsxs(r.Fragment,{children:["Compartilhar com outro usuário ",r.jsx(se,{})]})})})]})]})})};export{le as A,Le as S,fe as a,me as b,ke as c};
