import{c as b,a as se,r,j as e,P as A,g as ne,h as M,i as v,B as y,C as D,U as ie,o as oe,V as le,T as de,M as ce,q as x,O as ue,Q as fe,W as me,k as he,X as xe}from"./index-uK6KrvtY.js";import{E as I}from"./ElementTitleHeader-BMIW-P1G.js";import{u as ge}from"./useWearable-DRgUCxld.js";import{I as z,F as S,W as pe}from"./FieldContainer-CoKhSy4l.js";import{$ as ve}from"./module-BDisjovG.js";import{B as P}from"./Backdrop-BtNwZ8JP.js";import{I as je}from"./input-B4bQcZNA.js";import{H as R}from"./HorizontalDivider-C9p8xqYR.js";import{g as _,u as ye}from"./storage-C_jh6VqU.js";import"./react-DDCWQfk_.js";import"./react-dom-DxV6jaKz.js";import"./index-DkU7GfEn.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=b("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=b("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=b("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var k="Avatar",[be,Ve]=se(k),[Ae,B]=be(k),H=r.forwardRef((a,s)=>{const{__scopeAvatar:o,...c}=a,[l,n]=r.useState("idle");return e.jsx(Ae,{scope:o,imageLoadingStatus:l,onImageLoadingStatusChange:n,children:e.jsx(A.span,{...c,ref:s})})});H.displayName=k;var V="AvatarImage",$=r.forwardRef((a,s)=>{const{__scopeAvatar:o,src:c,onLoadingStatusChange:l=()=>{},...n}=a,u=B(V,o),i=ke(c,n.referrerPolicy),t=ne(m=>{l(m),u.onImageLoadingStatusChange(m)});return M(()=>{i!=="idle"&&t(i)},[i,t]),i==="loaded"?e.jsx(A.img,{...n,ref:s,src:c}):null});$.displayName=V;var U="AvatarFallback",W=r.forwardRef((a,s)=>{const{__scopeAvatar:o,delayMs:c,...l}=a,n=B(U,o),[u,i]=r.useState(c===void 0);return r.useEffect(()=>{if(c!==void 0){const t=window.setTimeout(()=>i(!0),c);return()=>window.clearTimeout(t)}},[c]),u&&n.imageLoadingStatus!=="loaded"?e.jsx(A.span,{...l,ref:s}):null});W.displayName=U;function ke(a,s){const[o,c]=r.useState("idle");return M(()=>{if(!a){c("error");return}let l=!0;const n=new window.Image,u=i=>()=>{l&&c(i)};return c("loading"),n.onload=u("loaded"),n.onerror=u("error"),n.src=a,s&&(n.referrerPolicy=s),()=>{l=!1}},[a,s]),o}var L=H,q=$,O=W;const G=r.forwardRef(({className:a,...s},o)=>e.jsx(L,{ref:o,className:v("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...s}));G.displayName=L.displayName;const K=r.forwardRef(({className:a,...s},o)=>e.jsx(q,{ref:o,className:v("aspect-square h-full w-full",a),...s}));K.displayName=q.displayName;const Q=r.forwardRef(({className:a,...s},o)=>e.jsx(O,{ref:o,className:v("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...s}));Q.displayName=O.displayName;const T=({value:a,onConfirm:s,onChange:o,placeholder:c,...l})=>{const{isEditing:n,setIsEditing:u}=r.useContext(z),[i,t]=r.useState(a??"");r.useEffect(()=>{t(a??"")},[a]);const m=()=>{s?s(i).finally(()=>{u(!1)}):u(!1)},p=h=>{t(h.target.value),o&&o(h)};return e.jsxs(e.Fragment,{children:[n&&e.jsx(P,{onClose:m,open:n,confirm:a!==i}),e.jsx("div",{className:v("text-lg flex items-center relative",n?"rounded-md gap-2 z-[20] w-full sm:max-w-xs":"gap-4"),onSubmit:h=>{h.preventDefault(),m()},children:e.jsxs("div",{className:"relative flex w-full",children:[e.jsx(je,{value:a,onChange:p,placeholder:c,onFocus:()=>{u(!0)},onBlur:()=>{u(!1),m()},className:v("w-full",n?"pr-10":""),...l}),n&&e.jsx(e.Fragment,{children:e.jsx(y,{onClick:m,type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",children:e.jsx(D,{className:"h-4 w-4 horizontal-grow z-10",color:"white"})})})]})})]})},X=r.forwardRef(({className:a,...s},o)=>e.jsx("textarea",{className:v("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:o,...s}));X.displayName="Textarea";const Ee=({value:a,onConfirm:s,onChange:o,placeholder:c,...l})=>{const{isEditing:n,setIsEditing:u}=r.useContext(z),i=r.useRef(null),[t,m]=r.useState(a??"");r.useEffect(()=>{m(a??""),i.current&&p()},[a]),r.useEffect(()=>{if(i.current){const g=parseFloat(getComputedStyle(i.current).lineHeight||"20");i.current.style.height=`${g*2}px`}},[]);const p=()=>{i.current&&(i.current.style.height="auto",i.current.style.height=`${i.current.scrollHeight}px`)},h=()=>{s?s(t).finally(()=>{u(!1)}):u(!1)},N=g=>{m(g.target.value),o&&o(g),p()};return e.jsxs(e.Fragment,{children:[n&&e.jsx(P,{onClose:h,open:n,confirm:a!==t}),e.jsx("div",{className:v("text-md flex items-center relative w-full",n?"rounded-md gap-2 z-[20] sm:max-w-md":"gap-4 max-w-xs"),onSubmit:g=>{g.preventDefault(),h()},children:e.jsxs("div",{className:"relative flex w-full",children:[e.jsx(X,{ref:i,value:t,onChange:N,placeholder:c,onFocusCapture:()=>u(!0),onBlur:()=>{u(!1),h()},className:v("w-full resize-none overflow-hidden min-h-3",n?"pr-10":""),...l}),n&&e.jsx(y,{onClick:h,type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 px-3 py-2 hover:bg-transparent",children:e.jsx(D,{className:"h-4 w-4 horizontal-grow z-10",color:"white"})})]})})]})},$e=()=>{var F;const{id:a}=ie(),s=r.useRef(null),[o,c]=r.useState(!1),{wearable:l,loading:n}=ge(a),[u,i]=r.useState(null),[t,m]=r.useState(void 0),[p,h]=r.useState(void 0),[N,g]=r.useState(void 0),[E,C]=r.useState(),J=oe();if(r.useEffect(()=>{l&&(m(l),h(l.birthday?new Date(l.birthday).toLocaleDateString("pt-BR"):void 0),l.avatar_url&&(i(_(l.avatar_url).data.publicUrl),console.log(_(l.avatar_url))),l.refresh_delay&&g(l.refresh_delay))},[l]),n)return e.jsx("div",{children:"Carregando..."});if(!l)return e.jsx("div",{className:"text-white",children:"Pulseira não encontrado"});const Y=async f=>{m(d=>d&&{...d,name:f})},Z=()=>{var f;(f=s.current)==null||f.click()},ee=async f=>{var j;const d=(j=f.target.files)==null?void 0:j[0];if(C(d),d){const w=new FileReader;w.onload=()=>{const re=w.result;i(re),x.success("Foto de perfil carregada com sucesso!")},w.onerror=()=>{x.error("Erro ao carregar foto de perfil.")},w.readAsDataURL(d)}},te=()=>{i(null),C(void 0),x.info("Foto de perfil removida.")},ae=async()=>{if(!t)return;if(!p){x.error("Data de nascimento inválida.");return}if(!t.name){x.error("Nome inválido.");return}if(!t.id){x.error("ID inválido.");return}if(!N){x.error("Taxa de atualização inválida.");return}c(!0);let f=null;try{if(E){const{data:d,error:j}=await ye(t.id,E);if(j)throw j;d&&(f=d.path)}try{const{error:d}=await xe(t.id,{name:t.name,birthday:new Date(p).toISOString(),other_info:t.other_info,avatar_url:f,refresh_delay:N});if(d)throw d;x.success("Dados salvos com sucesso."),J(`/dashboard/wearable/${t.id}`)}catch(d){console.error(d),x.error("Erro ao salvar dados.")}}catch(d){console.error(d),x.error("Erro ao salvar foto de perfil.")}c(!1)};return e.jsxs("div",{className:"space-y-3 text-white",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(I,{className:"text-white",title:t!=null&&t.name?t==null?void 0:t.name:"Sem nome"}),e.jsxs(G,{className:"h-36 w-36 mt-6 mb-3 border-2 border-white shadow-md",children:[e.jsx(K,{src:u||void 0,className:"object-cover "}),e.jsx(Q,{className:"text-white text-7xl font-semibold bg-white/10",children:(F=le(t!=null&&t.name?t==null?void 0:t.name:"Sem nome"))==null?void 0:F.slice(0,2)})]}),e.jsxs(de,{children:[e.jsx(ce,{onClick:()=>{navigator.clipboard.writeText((t==null?void 0:t.id)??""),x.success("Endereço MAC copiado para a área de transferência")},children:e.jsx("div",{className:"flex items-center justify-center border rounded-md px-2 text-white ",children:t==null?void 0:t.id})}),e.jsxs(ue,{side:"bottom",children:[e.jsx("p",{children:"Endereço MAC"}),e.jsx(fe,{className:"stroke-white fill-white"})]})]})]}),e.jsx(R,{className:"my-7"}),e.jsx(S,{title:"Nome",children:e.jsx(T,{value:(t==null?void 0:t.name)??"Sem Nome",onChange:f=>Y(f.target.value),type:"text",placeholder:"Fulano da Silva"})}),e.jsx(S,{title:"Data de Nascimento",children:e.jsx(T,{value:p,placeholder:"Dia/Mês/Ano",onChange:f=>{const d=me(f.target.value);h(d)},type:"text",inputMode:"numeric",pattern:"\\d*",maxLength:10})}),e.jsxs(S,{title:"Foto de Perfil",children:[e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:ee,ref:s}),u?e.jsxs(y,{variant:"secondary",size:"sm",onClick:te,children:["Remover Foto",e.jsx(we,{})]}):e.jsxs(y,{variant:"secondary",size:"sm",onClick:Z,children:["Enviar Foto",e.jsx(Se,{})]})]}),e.jsx(S,{title:"Informações Adicionais",children:e.jsx(Ee,{placeholder:"Informações sobre dificuldades físicas.",value:(t==null?void 0:t.other_info)??"",onChange:f=>{m(d=>d&&{...d,other_info:f.target.value})}})}),e.jsx(R,{className:"sm:-mx-2 mt-8"}),e.jsx(I,{title:"Configuração da pulseira",description:"Defina as configurações da pulseira."}),e.jsx(he,{title:"Taxa de atualização",titleBackground:!0,border:!0,children:e.jsx("div",{className:"p-4 text-white",children:e.jsx(pe,{defaultValue:(t==null?void 0:t.refresh_delay)||void 0,onChangeComplete:f=>{g(f)}})})}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(y,{className:"bg-white text-primary",onClick:ae,disabled:o,children:o?e.jsxs(e.Fragment,{children:["Atualizando ",e.jsx(ve,{strokeColor:"#4b33be"})]}):e.jsxs(e.Fragment,{children:["Salvar ",e.jsx(Ne,{})]})})})]})};export{$e as default};
