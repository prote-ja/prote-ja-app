import{c as P,r as i,j as e,q as R,l as x,Y as _,J as w,m as f,a9 as y,ak as U,al as D,B as b,am as B,an as m,ao as v,f as p,ap as F}from"./index-B3oemZXq.js";import{$ as V}from"./module-wSzv1A-q.js";import{E as z}from"./eye-DCQcokSE.js";import{P as $}from"./pencil-BSQhut8t.js";import{C as q}from"./clock-DKytNQuJ.js";import{C as T}from"./chevron-down-CYtNaYn4.js";import{H as j}from"./HorizontalDivider-CXeTq9tm.js";import{S as H}from"./share-2-CaDP7fPs.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=P("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var g="Avatar",[K,le]=R(g),[W,A]=K(g),N=i.forwardRef((s,r)=>{const{__scopeAvatar:a,...n}=s,[d,o]=i.useState("idle");return e.jsx(W,{scope:a,imageLoadingStatus:d,onImageLoadingStatusChange:o,children:e.jsx(x.span,{...n,ref:r})})});N.displayName=g;var S="AvatarImage",k=i.forwardRef((s,r)=>{const{__scopeAvatar:a,src:n,onLoadingStatusChange:d=()=>{},...o}=s,l=A(S,a),c=G(n,o.referrerPolicy),u=_(t=>{d(t),l.onImageLoadingStatusChange(t)});return w(()=>{c!=="idle"&&u(c)},[c,u]),c==="loaded"?e.jsx(x.img,{...o,ref:r,src:n}):null});k.displayName=S;var C="AvatarFallback",L=i.forwardRef((s,r)=>{const{__scopeAvatar:a,delayMs:n,...d}=s,o=A(C,a),[l,c]=i.useState(n===void 0);return i.useEffect(()=>{if(n!==void 0){const u=window.setTimeout(()=>c(!0),n);return()=>window.clearTimeout(u)}},[n]),l&&o.imageLoadingStatus!=="loaded"?e.jsx(x.span,{...d,ref:r}):null});L.displayName=C;function G(s,r){const[a,n]=i.useState("idle");return w(()=>{if(!s){n("error");return}let d=!0;const o=new window.Image,l=c=>()=>{d&&n(c)};return n("loading"),o.onload=l("loaded"),o.onerror=l("error"),o.src=s,r&&(o.referrerPolicy=r),()=>{d=!1}},[s,r]),a}var M=N,E=k,I=L;const J=i.forwardRef(({className:s,...r},a)=>e.jsx(M,{ref:a,className:f("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r}));J.displayName=M.displayName;const O=i.forwardRef(({className:s,...r},a)=>e.jsx(E,{ref:a,className:f("aspect-square h-full w-full",s),...r}));O.displayName=E.displayName;const Y=i.forwardRef(({className:s,...r},a)=>e.jsx(I,{ref:a,className:f("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r}));Y.displayName=I.displayName;async function Q(s){console.log("id",s);const r=await y.from("permissions_view").select().eq("device",s).order("created_at",{ascending:!1});return console.log("res",r),r}async function X(s,r){return await y.from("tracking_permissions").update({permission:r}).eq("id",s).select().returns()}function Z(s){const[r,a]=i.useState([]),[n,d]=i.useState(!0),[o,l]=i.useState(0),c=i.useCallback(()=>{l(u=>u+1),console.log("forceUpdate")},[]);return i.useEffect(()=>{if(!s)return;(async()=>{d(!0);try{const t=await Q(s);t.error?(console.error("Error fetching permissions:",t.error),a([])):a(t.data)}catch(t){console.error("Unexpected error fetching permissions:",t),a([])}finally{d(!1)}})()},[s,o]),{permissions:r,loading:n,forceUpdate:c}}const ee=({permission:s,users:r,forceUpdate:a,loading:n})=>{const d=r.find(c=>c.id===s.user),o=async c=>{if(s.id)try{const u=await X(s.id,c);if(u.error)throw new Error(u.error.message);p.success("Permissão atualizada com sucesso"),a()}catch(u){console.error("Unexpected error updating permission:",u),p.error("Algo deu errado ao atualizar a permissão")}},l=()=>{switch(s.permission){case"viewer":return"Apenas ver";case"editor":return"Ver e editar";case"pending":return"Aguardando";case"blocked":return"Bloqueado"}};return e.jsxs("div",{className:"text-white flex justify-between items-center p-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold line-clamp-1",children:d==null?void 0:d.name}),n?e.jsx("div",{className:"flex space-x-2",children:e.jsxs("div",{className:"bg-background border flex text-sm gap-1 rounded-full px-2 py-1 font-medium items-center text-muted",children:["Atualizando",e.jsx(V,{strokeColor:"white",width:"15"})]})}):e.jsxs("div",{className:"flex space-x-2",children:[(s.permission==="viewer"||s.permission==="editor")&&e.jsxs("div",{className:"bg-[#7AC74F] flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Visualizar",e.jsx(z,{className:"h-4"})]}),s.permission==="editor"&&e.jsxs("div",{className:"bg-[#FAA916] flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Modificar",e.jsx($,{className:"h-3"})]}),s.permission==="pending"&&e.jsxs("div",{className:"bg-background border flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Pendente",e.jsx(q,{className:"h-3"})]})]})]}),e.jsx("div",{children:e.jsxs(U,{children:[e.jsx(D,{children:e.jsxs(b,{variant:s.permission==="pending"?"default":"secondary",className:f(s.permission==="pending"?"text-primary bg-white":""),size:"sm",children:[l()," ",e.jsx(T,{})]})}),e.jsxs(B,{side:"bottom",children:[e.jsx(m,{onClick:()=>{o("editor")},children:"Ver e editar"}),e.jsx(m,{onClick:()=>{o("viewer")},children:"Apenas ver"}),e.jsx(v,{}),e.jsx(m,{onClick:()=>{o("pending")},children:"Remover permissão"}),e.jsx(v,{}),e.jsx(m,{onClick:()=>{o("blocked")},children:"Bloquear"})]})]})})]})},ue=({id:s})=>{const{permissions:r,loading:a,forceUpdate:n}=Z(s),[d,o]=i.useState([]),l=i.useMemo(()=>r.filter(t=>t.permission!=="blocked"),[r]),c=i.useMemo(()=>{const t=[];for(const h of l)h.user&&t.push(h.user);return t},[l]),u=async()=>{try{const t=await F(c);if(t.error)throw new Error(t.error.message);console.log("Users fetched:",t),o(t.data)}catch(t){console.log("Unexpected error fetching users:",t),p.error("Algo deu errado ao buscar os usuários")}};return i.useEffect(()=>{c.length&&u()},[c]),e.jsx("div",{children:e.jsxs("ul",{children:[l.map(t=>e.jsxs("li",{children:[e.jsx(j,{className:"border-white my-0"}),e.jsx(ee,{permission:t,users:d,forceUpdate:n,loading:a})]},t.user)),e.jsxs("li",{children:[e.jsx(j,{className:"border-white my-0"}),e.jsx("div",{className:"flex justify-center p-4 ",children:e.jsx(b,{variant:"secondary",disabled:a,children:a?"Carregando...":e.jsxs(e.Fragment,{children:["Compartilhar com outro usuário ",e.jsx(H,{})]})})})]})]})})};export{J as A,ue as S,O as a,Y as b,de as c};
