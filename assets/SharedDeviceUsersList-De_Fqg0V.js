import{c as x,r as i,j as e,q as R,l as g,X as _,Y as y,m as f,Q as b,a5 as D,a6 as U,B as A,a7 as B,a8 as m,a9 as j,f as p,aa as F}from"./index-23tTh8js.js";import{$ as V}from"./module-BN6hsvvt.js";import{E as q}from"./eye-6JvO2Scb.js";import{P as z}from"./pencil-BqvKn1WM.js";import{H as w}from"./HorizontalDivider-Qjarxl2V.js";import{S as $}from"./share-2-C4LuSN41.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=x("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=x("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=x("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var h="Avatar",[K,ce]=R(h),[W,N]=K(h),k=i.forwardRef((s,r)=>{const{__scopeAvatar:a,...n}=s,[d,o]=i.useState("idle");return e.jsx(W,{scope:a,imageLoadingStatus:d,onImageLoadingStatusChange:o,children:e.jsx(g.span,{...n,ref:r})})});k.displayName=h;var S="AvatarImage",C=i.forwardRef((s,r)=>{const{__scopeAvatar:a,src:n,onLoadingStatusChange:d=()=>{},...o}=s,l=N(S,a),c=G(n,o.referrerPolicy),u=_(t=>{d(t),l.onImageLoadingStatusChange(t)});return y(()=>{c!=="idle"&&u(c)},[c,u]),c==="loaded"?e.jsx(g.img,{...o,ref:r,src:n}):null});C.displayName=S;var L="AvatarFallback",M=i.forwardRef((s,r)=>{const{__scopeAvatar:a,delayMs:n,...d}=s,o=N(L,a),[l,c]=i.useState(n===void 0);return i.useEffect(()=>{if(n!==void 0){const u=window.setTimeout(()=>c(!0),n);return()=>window.clearTimeout(u)}},[n]),l&&o.imageLoadingStatus!=="loaded"?e.jsx(g.span,{...d,ref:r}):null});M.displayName=L;function G(s,r){const[a,n]=i.useState("idle");return y(()=>{if(!s){n("error");return}let d=!0;const o=new window.Image,l=c=>()=>{d&&n(c)};return n("loading"),o.onload=l("loaded"),o.onerror=l("error"),o.src=s,r&&(o.referrerPolicy=r),()=>{d=!1}},[s,r]),a}var E=k,I=C,P=M;const O=i.forwardRef(({className:s,...r},a)=>e.jsx(E,{ref:a,className:f("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r}));O.displayName=E.displayName;const Q=i.forwardRef(({className:s,...r},a)=>e.jsx(I,{ref:a,className:f("aspect-square h-full w-full",s),...r}));Q.displayName=I.displayName;const X=i.forwardRef(({className:s,...r},a)=>e.jsx(P,{ref:a,className:f("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r}));X.displayName=P.displayName;async function Y(s){console.log("id",s);const r=await b.from("permissions_view").select().eq("device",s).order("created_at",{ascending:!1});return console.log("res",r),r}async function J(s,r){return await b.from("tracking_permissions").update({permission:r}).eq("id",s).select().returns()}function Z(s){const[r,a]=i.useState([]),[n,d]=i.useState(!0),[o,l]=i.useState(0),c=i.useCallback(()=>{l(u=>u+1),console.log("forceUpdate")},[]);return i.useEffect(()=>{if(!s)return;(async()=>{d(!0);try{const t=await Y(s);t.error?(console.error("Error fetching permissions:",t.error),a([])):a(t.data)}catch(t){console.error("Unexpected error fetching permissions:",t),a([])}finally{d(!1)}})()},[s,o]),{permissions:r,loading:n,forceUpdate:c}}const ee=({permission:s,users:r,forceUpdate:a,loading:n})=>{const d=r.find(c=>c.id===s.user),o=async c=>{if(s.id)try{const u=await J(s.id,c);if(u.error)throw new Error(u.error.message);p.success("Permissão atualizada com sucesso"),a()}catch(u){console.error("Unexpected error updating permission:",u),p.error("Algo deu errado ao atualizar a permissão")}},l=()=>{switch(s.permission){case"viewer":return"Apenas ver";case"editor":return"Ver e editar";case"pending":return"Aguardando";case"blocked":return"Bloqueado"}};return e.jsxs("div",{className:"text-white flex justify-between items-center p-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold line-clamp-1",children:d==null?void 0:d.name}),n?e.jsx("div",{className:"flex space-x-2",children:e.jsxs("div",{className:"bg-background border flex text-sm gap-1 rounded-full px-2 py-1 font-medium items-center text-muted",children:["Atualizando",e.jsx(V,{strokeColor:"white",width:"15"})]})}):e.jsxs("div",{className:"flex space-x-2",children:[(s.permission==="viewer"||s.permission==="editor")&&e.jsxs("div",{className:"bg-[#7AC74F] flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Visualizar",e.jsx(q,{className:"h-4"})]}),s.permission==="editor"&&e.jsxs("div",{className:"bg-[#FAA916] flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Modificar",e.jsx(z,{className:"h-3"})]}),s.permission==="pending"&&e.jsxs("div",{className:"bg-background border flex text-sm rounded-full pl-2 pr-1 py-1 font-medium items-center",children:["Pendente",e.jsx(H,{className:"h-3"})]})]})]}),e.jsx("div",{children:e.jsxs(D,{children:[e.jsx(U,{children:e.jsxs(A,{variant:s.permission==="pending"?"default":"secondary",className:f(s.permission==="pending"?"text-primary bg-white":""),size:"sm",children:[l()," ",e.jsx(T,{})]})}),e.jsxs(B,{side:"bottom",children:[e.jsx(m,{onClick:()=>{o("editor")},children:"Ver e editar"}),e.jsx(m,{onClick:()=>{o("viewer")},children:"Apenas ver"}),e.jsx(j,{}),e.jsx(m,{onClick:()=>{o("pending")},children:"Remover permissão"}),e.jsx(j,{}),e.jsx(m,{onClick:()=>{o("blocked")},children:"Bloquear"})]})]})})]})},de=({id:s})=>{const{permissions:r,loading:a,forceUpdate:n}=Z(s),[d,o]=i.useState([]),l=i.useMemo(()=>r.filter(t=>t.permission!=="blocked"),[r]),c=i.useMemo(()=>{const t=[];for(const v of l)v.user&&t.push(v.user);return t},[l]),u=async()=>{try{const t=await F(c);if(t.error)throw new Error(t.error.message);console.log("Users fetched:",t),o(t.data)}catch(t){console.log("Unexpected error fetching users:",t),p.error("Algo deu errado ao buscar os usuários")}};return i.useEffect(()=>{c.length&&u()},[c]),e.jsx("div",{children:e.jsxs("ul",{children:[l.map(t=>e.jsxs("li",{children:[e.jsx(w,{className:"border-white my-0"}),e.jsx(ee,{permission:t,users:d,forceUpdate:n,loading:a})]},t.user)),e.jsxs("li",{children:[e.jsx(w,{className:"border-white my-0"}),e.jsx("div",{className:"flex justify-center p-4 ",children:e.jsx(A,{variant:"secondary",disabled:a,children:a?"Carregando...":e.jsxs(e.Fragment,{children:["Compartilhar com outro usuário ",e.jsx($,{})]})})})]})]})})};export{O as A,de as S,Q as a,X as b,ie as c};
